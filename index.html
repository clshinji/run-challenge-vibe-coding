<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>キッズアドベンチャー - 横スクロールゲーム</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/share-styles.css" />
  </head>
  <body>
    <!-- ゲームコンテナ -->
    <div id="gameContainer">
      <!-- タイトル画面 -->
      <div id="titleScreen" class="screen active">
        <h1>キッズアドベンチャー</h1>
        <div class="character-preview"></div>

        <!-- プレイヤー名表示エリア -->
        <div id="playerNameDisplay" class="player-name-display">
          <div class="player-name-label">なまえ:</div>
          <div id="currentPlayerName" class="current-player-name">
            なまえがないよ
          </div>
          <button id="editPlayerNameButton" class="game-button secondary">
            なまえをかえる
          </button>
        </div>

        <div class="menu-buttons">
          <button id="startButton" class="game-button">ゲームスタート</button>
          <button id="playerListButton" class="game-button">
            プレイヤーいちらん
          </button>
          <button id="statsButton" class="game-button">せいせき</button>
          <button id="settingsButton" class="game-button">せってい</button>
        </div>
      </div>

      <!-- ユーザー名入力画面 -->
      <div id="nameInputScreen" class="screen">
        <h2>なまえをいれてね</h2>
        <input
          type="text"
          id="playerNameInput"
          placeholder="なまえ"
          maxlength="10"
        />
        <div class="menu-buttons">
          <button id="nameConfirmButton" class="game-button">OK</button>
          <button id="nameBackButton" class="game-button secondary">
            もどる
          </button>
        </div>
      </div>

      <!-- プレイヤー名編集画面 -->
      <div id="editNameScreen" class="screen">
        <h2>なまえをかえる</h2>

        <!-- 現在の情報表示 -->
        <div class="current-player-info">
          <div class="current-name-info">
            <span>いまのなまえ: </span>
            <span id="currentNameInEdit" class="current-name-text">未設定</span>
          </div>
          <div class="current-icon-info">
            <span>いまのアイコン: </span>
            <span id="currentIconInEdit" class="current-icon-display-small"
              >🐱</span
            >
          </div>
        </div>

        <!-- 名前入力 -->
        <input
          type="text"
          id="editPlayerNameInput"
          placeholder="あたらしいなまえ"
          maxlength="10"
        />

        <!-- アイコン選択 -->
        <div class="edit-icon-section">
          <div class="edit-icon-label">アイコンをえらんでね:</div>
          <div class="edit-icon-grid" id="editIconGrid">
            <!-- アイコンは動的に生成 -->
          </div>
        </div>

        <div class="menu-buttons">
          <button id="confirmEditNameButton" class="game-button">かえる</button>
          <button id="cancelEditNameButton" class="game-button secondary">
            もどる
          </button>
        </div>
      </div>

      <!-- プレイヤー一覧画面 -->
      <div id="playerListScreen" class="screen">
        <h2>プレイヤーいちらん</h2>

        <!-- 現在のプレイヤー表示 -->
        <div class="current-player-display">
          <span class="current-player-label">いまのプレイヤー</span>
          <span id="playerListCurrentPlayerIcon" class="current-player-icon">🐱</span>
          <span id="playerListCurrentPlayerName" class="current-player-name">未設定</span>
        </div>

        <div class="player-list-container">
          <div id="playerList" class="player-list">
            <!-- プレイヤーカードは動的に生成 -->
          </div>
        </div>
        <div class="menu-buttons">
          <button id="playWithPlayerButton" class="game-button">
            このプレイヤーであそぶ
          </button>
          <button id="addNewPlayerButton" class="game-button">
            あたらしいプレイヤー
          </button>
          <button id="playerListBackButton" class="game-button secondary">
            もどる
          </button>
        </div>
      </div>

      <!-- アイコン選択画面 -->
      <div id="iconSelectScreen" class="screen">
        <h2>アイコンをえらんでね</h2>
        <div class="current-icon-display">
          <div class="current-icon-label">いまのアイコン:</div>
          <div id="currentIconDisplay" class="current-icon">🐱</div>
        </div>
        <div class="icon-grid" id="iconGrid">
          <!-- アイコンは動的に生成 -->
        </div>
        <div class="menu-buttons">
          <button id="iconSelectBackButton" class="game-button secondary">
            もどる
          </button>
        </div>
      </div>

      <!-- ステージ選択画面 -->
      <div id="stageSelectScreen" class="screen">
        <h2>ステージをえらんでね</h2>
        <div id="stageButtons" class="stage-grid">
          <!-- ステージボタンは動的に生成 -->
        </div>
        <button id="stageBackButton" class="game-button secondary">
          もどる
        </button>
      </div>

      <!-- ゲーム画面 -->
      <div id="gameScreen" class="screen">
        <!-- 統合インフォメーションエリア -->
        <div id="gameUI">
          <div id="integratedInfoArea" class="integrated-info-area">
            <!-- 戻るボタン -->
            <button id="backToStageButton" class="back-button">
              <span class="back-icon">🏠</span>
              <span class="back-text">もどる</span>
            </button>

            <!-- メイン情報バー -->
            <div class="main-info-bar">
              <!-- 左側：スコアとレベル -->
              <div class="info-group left-group">
                <div class="info-item score-item">
                  <div class="info-icon">⭐</div>
                  <div class="info-content">
                    <div class="info-label">スコア</div>
                    <div class="info-value" id="score">0</div>
                  </div>
                </div>
                <div class="info-item level-item">
                  <div class="info-icon">🎯</div>
                  <div class="info-content">
                    <div class="info-label" id="levelLabel">レベル 1</div>
                    <div class="info-value level-ability" id="levelAbility">
                      ダブルジャンプ
                    </div>
                  </div>
                </div>
              </div>

              <!-- 中央：プログレスバー -->
              <div class="info-group center-group">
                <div class="progress-section">
                  <div class="progress-header">
                    <span class="progress-label">あつめた アイテム</span>
                    <span class="progress-count" id="progressCount">0/7</span>
                  </div>
                  <div class="progress-container">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-stars">☆☆☆☆☆☆☆☆☆☆</div>
                  </div>
                </div>
              </div>

              <!-- 右側：時間とライフ -->
              <div class="info-group right-group">
                <div class="info-item time-item">
                  <div class="info-icon">⏰</div>
                  <div class="info-content">
                    <div class="info-label">じかん</div>
                    <div class="info-value" id="time">0</div>
                  </div>
                </div>
                <div class="info-item lives-item">
                  <div class="info-icon">⛑️</div>
                  <div class="info-content">
                    <div class="info-label">ライフ</div>
                    <div class="info-value hearts-container" id="hearts"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ゲームキャンバス -->
        <canvas id="gameCanvas" width="800" height="400"></canvas>

        <!-- タッチ操作用コントロール（バーチャルパッド） -->
        <div id="touchControls" class="touch-controls">
          <div id="virtualPad" class="virtual-pad">
            <div class="pad-background"></div>
            <div class="pad-stick"></div>
          </div>
          <div class="control-right">
            <button id="jumpButton" class="control-button jump">
              ジャンプ
            </button>
          </div>
        </div>
      </div>

      <!-- 一時停止画面 -->
      <div id="pauseScreen" class="screen overlay">
        <div class="pause-menu">
          <h2>いちじていし</h2>
          <div class="menu-buttons">
            <button id="resumeButton" class="game-button">つづける</button>
            <button id="restartButton" class="game-button">さいスタート</button>
            <button id="pauseBackButton" class="game-button secondary">
              メニューへ
            </button>
          </div>
        </div>
      </div>

      <!-- ゲームクリア画面 -->
      <div id="clearScreen" class="screen overlay">
        <div class="result-menu">
          <h2>ステージクリア！</h2>
          <div class="result-stats">
            <p>スコア: <span id="clearScore">0</span></p>
            <p>タイム: <span id="clearTime">0</span>秒</p>
            <p>アイテム: <span id="clearItems">0</span>個</p>
          </div>
          <div class="menu-buttons">
            <button id="nextStageButton" class="game-button">
              つぎのステージへ
            </button>
            <button id="clearBackButton" class="game-button secondary">
              もどる
            </button>
          </div>
        </div>
      </div>

      <!-- ゲームオーバー画面 -->
      <div id="gameOverScreen" class="screen overlay">
        <div class="result-menu">
          <h2>ざんねん...</h2>
          <p>もういちど ちょうせんしてみよう！</p>
          <div class="menu-buttons">
            <button id="retryButton" class="game-button">もういちど</button>
            <button id="gameOverBackButton" class="game-button secondary">
              ステージせんたく
            </button>
          </div>
        </div>
      </div>

      <!-- 統計・ダッシュボード画面 -->
      <div id="statsScreen" class="screen">
        <div class="stats-screen-header">
          <h2>せいせき</h2>
        </div>

        <div class="stats-content-wrapper">
          <!-- 総合スコア表示 -->
          <div class="stats-summary">
            <div class="stats-summary-header">
              <div class="score-label">そうごうスコア</div>
            </div>
            <div class="stats-summary-content">
              <div class="total-score-display">
                <div id="totalScoreValue" class="score-value">0</div>
                <div class="score-progress">
                  <div id="totalScoreBar" class="progress-bar">
                    <div class="progress-fill"></div>
                  </div>
                  <div class="progress-text">
                    レベル <span id="playerLevel">1</span>
                  </div>
                  <div class="level-info">
                    <div class="current-level">
                      げんざいのレベル: <span id="currentLevelText">1</span>
                    </div>
                    <div class="next-level">
                      つぎのレベルまで:
                      <span id="nextLevelPoints">1000</span>てん
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ステージ別成績 -->
          <div class="stage-stats">
            <h3>ステージべつせいせき</h3>
            <div id="stageStatsContainer" class="stage-stats-grid">
              <!-- 動的に生成 -->
            </div>
          </div>

          <!-- 最近の成績グラフ -->
          <div class="recent-stats">
            <h3>さいきんのせいせき</h3>
            <div id="recentStatsChart" class="stats-chart">
              <!-- グラフエリア -->
            </div>
          </div>

          <!-- 成績共有セクション -->
          <div class="share-section">
            <h3>せいせきをきょうゆう</h3>
            <div class="share-options">
              <button id="shareAsCertificate" class="share-button">
                📜 ひょうしょうじょう
              </button>
              <button id="shareAsDashboard" class="share-button">
                📊 せいせきひょう
              </button>
            </div>
            <div class="share-preview">
              <canvas id="sharePreviewCanvas" width="400" height="300"></canvas>
            </div>
            <div class="share-actions" style="display: none;">
              <button id="downloadImage" class="action-button">
                💾 がぞうをほぞん
              </button>
              <button id="shareToSocial" class="action-button">
                📱 きょうゆう
              </button>
            </div>
          </div>

          <div class="menu-buttons">
            <button id="statsBackButton" class="game-button secondary">
              もどる
            </button>
          </div>
        </div>
      </div>
      <div id="settingsScreen" class="screen">
        <h2>せってい</h2>
        <div class="settings-options">
          <div class="setting-item">
            <label>おんがく</label>
            <button id="musicToggle" class="toggle-button">ON</button>
          </div>
          <div class="setting-item">
            <label>こうかおん</label>
            <button id="soundToggle" class="toggle-button">ON</button>
          </div>
          <div class="setting-item">
            <label>デバッグじょうほう</label>
            <button id="debugInfoToggle" class="toggle-button">OFF</button>
          </div>
          <div class="setting-item debug-section">
            <label>デバッグ機能</label>
            <div class="setting-item">
              <span>テストデータ生成</span>
              <button id="testDataToggle" class="toggle-button">OFF</button>
            </div>
          </div>
          
          <div class="setting-item gamepad-section">
            <label>ゲームコントローラー</label>
            <div class="setting-item">
              <span>コントローラー対応</span>
              <button id="gamepadToggle" class="toggle-button">ON</button>
            </div>
            <div class="setting-item">
              <span>せんたく感度</span>
              <div class="range-control">
                <input type="range" id="gamepadDeadzone" min="0.05" max="0.5" step="0.05" value="0.15">
                <span id="deadzoneValue">0.15</span>
              </div>
            </div>
            <div class="setting-item gamepad-status">
              <span>接続状態</span>
              <span id="gamepadConnectionStatus" class="status-indicator">未接続</span>
            </div>
            <div class="setting-item gamepad-test">
              <span>接続テスト</span>
              <button id="gamepadTestButton" class="action-button">テストかいし</button>
            </div>
          </div>
        </div>
        <button id="settingsBackButton" class="game-button secondary">
          もどる
        </button>
      </div>
    </div>

    <!-- JavaScript読み込み（同期・順序保証） -->
    <script src="js/storage.js?v=62"></script>
    <script src="js/share-generator.js?v=62"></script>
    <script src="js/player.js?v=62"></script>
    <script src="js/stage.js?v=62"></script>
    <script src="js/goal-animation.js?v=62"></script>
    <script src="js/gamepad-manager.js?v=62"></script>
    <script src="js/game-simple.js?v=62"></script>
    <script src="js/ui.js?v=62"></script>

    <!-- UIManager初期化 -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (typeof UIManager !== "undefined") {
          window.uiManager = new UIManager();
        }
      });
    </script>
  </body>
</html>
